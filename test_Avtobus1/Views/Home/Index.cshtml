@model List<ShortUrl>
@if (TempData["Error"] != null)
{
    <div style="color:red; margin-bottom:10px;">
        @TempData["Error"]
    </div>
}

<h2>URL Shortener</h2>

<form asp-action="Create" method="post" class="mb-3">
    <div>
        <input type="text" name="originalUrl" placeholder="Введите длинный URL" style="width:400px" />
        <button type="submit">Сократить</button>
    </div>
</form>

<table border="1" cellpadding="5">
    <thead>
    <tr>
        <th>Длинный URL</th>
        <th>Сокращенный URL</th>
        <th>Дата создания</th>
        <th>Переходы</th>
        <th>Управление</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var item in Model)
    {
        var baseDomain = ViewBag.ShortBaseDomain as string;
        <tr>
            <td style="max-width:400px; word-break:break-all;">
                @item.OriginalUrl
            </td>
            <td>
                @{
                    var displayUrl = $"{baseDomain}/{item.ShortCode}";
                    var localRedirectUrl = Url.Content($"/{item.ShortCode}");
                }
                
                <a href="@localRedirectUrl" target="_blank">
                    @displayUrl
                </a>
            </td>
            <td>
                @item.CreatedAt.ToString("yyyy-MM-dd HH:mm")
            </td>
            <td>
                @item.ClickCount
            </td>
            <td>
                <form asp-action="Edit" method="post" style="display:inline;">
                    <input type="hidden" name="id" value="@item.Id" />
                    <input type="text" name="originalUrl" value="@item.OriginalUrl" style="width:250px" />
                    <button type="submit">Редактировать</button>
                </form>

                <form asp-action="Delete" method="post" style="display:inline;">
                    <input type="hidden" name="id" value="@item.Id" />
                    <button type="submit" onclick="return confirm('Удалить?')">Удалить</button>
                </form>
            </td>
        </tr>
    }
    </tbody>
</table>